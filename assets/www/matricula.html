<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        
        <meta name="format-detection" content="telephone=no" />        
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css" />

        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <script src="js/jquery-1.10.2.min.js"></script> 
        <script type="text/javascript" src="js/jquery.mobile-1.4.0.min.js"></script>
        <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <title>Ficha Escolar</title>
    </head>
    <body>
<!-- Start of first page: #one -->

<div data-role="page" id="one"> 
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">    
      <div class="container">
        
        <div class="navbar-header">        
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        
        <a class="navbar-brand" href="#">Ficha Escolar</a>

        </div>

        <div class="nav navbar-nav navbar-right collapse navbar-collapse mainmenu">
            <a data-rel="back" class="btn btn-danger navbar-btn btn-black"><i class="glyphicon glyphicon-chevron-left"></i></a>
            <a href="./main.html" class="btn btn-danger navbar-btn btn-black"><i class="glyphicon glyphicon-home"></i></a>
            <a href="./dbsinc.html" class="btn btn-danger navbar-btn btn-black"><i class="glyphicon glyphicon-refresh"></i></a>
        </div>
      </div>
    </div>
    <div id="headJumbo">
        <div class="jumbotron" data-role="header">
            <img src="./img/mineduc-small.jpg" />
            
            <h4 id="establecimientoNombre"></h4>
            <p class="lead"><br /><i>Seleccione los datos que desee visualizar utilizando cualquiera de las siguientes opciones.</i></p>
        </div>
    </div>
    <div class="container">
        <div role="main" class="main">
            <div class="row buttonList">
                <div rel="./matricula-inscripcion-inicial.html" class="col-xs-12 col-md-12 principalButton">Inscripción inicial
                    <span class="iconContainer"><i class="glyphicon glyphicon-chevron-right"></i></span>
                </div>
                
                <div rel="./matricula-repitentes.html" class="col-xs-12 col-md-12 principalButton">Repitentes
                    <span class="iconContainer"><i class="glyphicon glyphicon-chevron-right"></i></span>
                </div>

                <div rel="./matricula-inscripcion-final.html" class="col-xs-12 col-md-12 principalButton">Inscripción final
                    <span class="iconContainer"><i class="glyphicon glyphicon-chevron-right"></i></span>
                </div>

                <div rel="./matricula-retirados.html" class="col-xs-12 col-md-12 principalButton">Retirados
                    <span class="iconContainer"><i class="glyphicon glyphicon-chevron-right"></i></span>
                </div>

                <div rel="./matricula-promovidos.html" class="col-xs-12 col-md-12 principalButton">Promovidos
                    <span class="iconContainer"><i class="glyphicon glyphicon-chevron-right"></i></span>
                </div>

                <div rel="./matricula-no-promovidos.html" class="col-xs-12 col-md-12 principalButton">No promovidos
                    <span class="iconContainer"><i class="glyphicon glyphicon-chevron-right"></i></span>
                </div>
            </div>
            
        </div>

        

    
</div>
        <script type="text/javascript" src="phonegap.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                var data = window.localStorage.getItem("info");
                var info = $.parseJSON(data);

                $("#establecimientoNombre").html(info.NombreEstablecimiento + "<br /><small>" + info.NombreMunicipio + ", " + info.NombreDepartamento + "</small><small></small>");
                var db = window.openDatabase("fichaescolar", "1.0", "Ficha Escolar", 100000000); 
                var years = [];
                    getYears();
                    getInscripcionInicialData();
                    getTotalInscripcionInicialDataGenero();
                    getInscripcionInicialDetalle();

                    //llamada a funciones para graficas de repitentes
                    getRepitentesData();
                    getRepitentesDataGenero();
                    getRepitentesDetalle();

                    //Llamada a funciones para graficas de inscripcion final
                    getInscripcionFinalData();
                    getInscritosFinalGenero();
                    getInscritosFinalDetalle();


                    //Llamada a funciones para graficas de retirados
                    getRetiradosData();
                    getRetiradosGenero();
                    getRetiradosDetalle();

                    //Llamada a funciones para graficas de retirados
                    getPromovidosData();
                    getPromovidosGenero();
                    getPromovidosDetalle();


                    //Llamada a funciones para graficas de retirados
                    getNoPromovidosData();
                    getNoPromovidosGenero();
                    getNoPromovidosDetalle();

                    function getYears(){
                        db.transaction(
                            function(tx){
                                  tx.executeSql('SELECT DISTINCT Anio AS year FROM matricula WHERE CodigoUDI = ?', 
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var y = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            years.push(r.rows.item(i).year);
                                        }
                                        window.localStorage.setItem("years",JSON.stringify(years));
                                    }
                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }

                    function getInscripcionInicialData(){
                        db.transaction(
                            function(tx){
                                  tx.executeSql('SELECT Anio, SUM(InscritosInicialHombres+ InscritosInicialMujeres) AS total FROM matricula WHERE CodigoUDI = ? GROUP BY Anio', 
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            data.push(r.rows.item(i).total);
                                        }

                                        window.localStorage.setItem("totalesMatriculaInicial",JSON.stringify(data));
                                    }
                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }


                    function getTotalInscripcionInicialDataGenero(){
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, SUM(InscritosInicialHombres) AS hombres, SUM(InscritosInicialMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio',                                   
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var dataM = [];
                                    var dataH = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            dataM.push(r.rows.item(i).mujeres);
                                            dataH.push(r.rows.item(i).hombres);
                                        }

                                        window.localStorage.setItem("totalesMatriculaInicialHombres",JSON.stringify(dataH));
                                        window.localStorage.setItem("totalesMatriculaInicialMujeres",JSON.stringify(dataM));                                        
                                    }
                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }

                    function getInscripcionInicialDetalle(){
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, grado, SUM(InscritosInicialHombres) AS hombres, SUM(InscritosInicialMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio, grado',                                    
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            //data.push(JSON.stringify(r.rows.item(i)));
                                            data.push(r.rows.item(i));
                                        }
                                        window.localStorage.setItem("matriculaInicialDetalle",JSON.stringify(data));
                                    }
                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.message);
                                  return false;
                              }
                            )
                    }



                    function getRepitentesData(){
                        db.transaction(
                            function(tx){
                                  tx.executeSql('SELECT Anio, SUM(RepitentesHombres + RepitentesMujeres) AS total FROM matricula WHERE CodigoUDI = ? GROUP BY Anio', 
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            data.push(r.rows.item(i).total);
                                        }
                                        window.localStorage.setItem("acumuladoRepitentes",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }


                    function getRepitentesDataGenero(){
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, SUM(RepitentesHombres) AS hombres, SUM(RepitentesMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio',                                   
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var dataM = [];
                                    var dataH = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            dataM.push(r.rows.item(i).mujeres);
                                            dataH.push(r.rows.item(i).hombres);
                                        }
                                        window.localStorage.setItem("RepitentesHombres",JSON.stringify(dataH));
                                        window.localStorage.setItem("RepitentesMujeres",JSON.stringify(dataM));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }

                    function getRepitentesDetalle(){
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, grado, SUM(RepitentesHombres) AS hombres, SUM(RepitentesMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio, grado',                                    
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            //data.push(JSON.stringify(r.rows.item(i)));
                                            data.push(r.rows.item(i));
                                        }
                                        window.localStorage.setItem("repitentesDetalle",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.message);
                                  return false;
                              }
                            )
                    }



                    //Datos de la inscripcion final
                    function getInscripcionFinalData(){
                        db.transaction(
                            function(tx){
                                  tx.executeSql('SELECT Anio, SUM(InscritosFinalHombres + InscritosFinalMujeres) AS total FROM matricula WHERE CodigoUDI = ? GROUP BY Anio', 
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            data.push(r.rows.item(i).total);
                                        }
                                        window.localStorage.setItem("acumuladoInscripcionFinal",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }


                    function getInscritosFinalGenero(){
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, SUM(InscritosFinalHombres) AS hombres, SUM(InscritosFinalMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio',                                   
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var dataM = [];
                                    var dataH = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            dataM.push(r.rows.item(i).mujeres);
                                            dataH.push(r.rows.item(i).hombres);
                                        }
                                        window.localStorage.setItem("InscritosFinalHombres",JSON.stringify(dataH));
                                        window.localStorage.setItem("InscritosFinalMujeres",JSON.stringify(dataM));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }

                    function getInscritosFinalDetalle() {
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, grado, SUM(InscritosFinalHombres) AS hombres, SUM(InscritosFinalMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio, grado',                                    
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            //data.push(JSON.stringify(r.rows.item(i)));
                                            data.push(r.rows.item(i));
                                        }
                                        window.localStorage.setItem("InscritosFinalDetalle",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.message);
                                  return false;
                              }
                            )
                    }



                    //Datos de Retirados
                    function getRetiradosData(){
                        db.transaction(
                            function(tx){
                                  tx.executeSql('SELECT Anio, SUM(RetiradosHombres + RetiradosMujeres) AS total FROM matricula WHERE CodigoUDI = ? GROUP BY Anio', 
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            data.push(r.rows.item(i).total);
                                        }
                                        window.localStorage.setItem("acumuladoRetirados",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }


                    function getRetiradosGenero(){
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, SUM(RetiradosHombres) AS hombres, SUM(RetiradosMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio',                                   
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var dataM = [];
                                    var dataH = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            dataM.push(r.rows.item(i).mujeres);
                                            dataH.push(r.rows.item(i).hombres);
                                        }
                                        window.localStorage.setItem("RetiradosHombres",JSON.stringify(dataH));
                                        window.localStorage.setItem("RetiradosMujeres",JSON.stringify(dataM));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }

                    function getRetiradosDetalle() {
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, grado, SUM(RetiradosHombres) AS hombres, SUM(RetiradosMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio, grado',                                    
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            //data.push(JSON.stringify(r.rows.item(i)));
                                            data.push(r.rows.item(i));
                                        }
                                        window.localStorage.setItem("retiradosDetalle",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.message);
                                  return false;
                              }
                            )
                    }


                    //Datos de Promovidos
                    function getPromovidosData(){
                        db.transaction(
                            function(tx){
                                  tx.executeSql('SELECT Anio, SUM(PromovidosHombres + PromovidosMujeres) AS total FROM matricula WHERE CodigoUDI = ? GROUP BY Anio', 
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            data.push(r.rows.item(i).total);
                                        }
                                        window.localStorage.setItem("acumuladoPromovidos",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }


                    function getPromovidosGenero(){
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, SUM(PromovidosHombres) AS hombres, SUM(PromovidosMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio',                                   
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var dataM = [];
                                    var dataH = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            dataM.push(r.rows.item(i).mujeres);
                                            dataH.push(r.rows.item(i).hombres);
                                        }
                                        window.localStorage.setItem("PromovidosHombres",JSON.stringify(dataH));
                                        window.localStorage.setItem("PromovidosMujeres",JSON.stringify(dataM));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }                    

                    function getPromovidosDetalle() {
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, grado, SUM(PromovidosHombres) AS hombres, SUM(PromovidosMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio, grado',                                    
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            //data.push(JSON.stringify(r.rows.item(i)));
                                            data.push(r.rows.item(i));
                                        }
                                        window.localStorage.setItem("promovidosDetalle",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.message);
                                  return false;
                              }
                            )
                    }


                    //Datos de No Promovidos
                    function getNoPromovidosData(){
                        db.transaction(
                            function(tx){
                                  tx.executeSql('SELECT Anio, SUM(NoPromovidosHombres + NoPromovidosMujeres) AS total FROM matricula WHERE CodigoUDI = ? GROUP BY Anio', 
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            data.push(r.rows.item(i).total);
                                        }
                                        window.localStorage.setItem("acumuladoNoPromovidos",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }


                    function getNoPromovidosGenero(){
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, SUM(NoPromovidosHombres) AS hombres, SUM(NoPromovidosMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio',                                   
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var dataM = [];
                                    var dataH = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            dataM.push(r.rows.item(i).mujeres);
                                            dataH.push(r.rows.item(i).hombres);
                                        }
                                        window.localStorage.setItem("NoPromovidosHombres",JSON.stringify(dataH));
                                        window.localStorage.setItem("NoPromovidosMujeres",JSON.stringify(dataM));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.code + " : " + e.message);
                                  return false;
                              }
                            )
                    }                    

                    function getNoPromovidosDetalle() {
                        db.transaction(
                            function(tx){
                                tx.executeSql('SELECT Anio, grado, SUM(NoPromovidosHombres) AS hombres, SUM(NoPromovidosMujeres) AS mujeres FROM matricula WHERE CodigoUDI = ? GROUP BY Anio, grado',                                    
                                  [info.CodigoUDI],
                                  function(tx,r){
                                    var data = [];
                                    if(r.rows.length > 0){
                                        for(var i = 0; i<r.rows.length; i++){
                                            //data.push(JSON.stringify(r.rows.item(i)));
                                            data.push(r.rows.item(i));
                                        }
                                        window.localStorage.setItem("noPromovidosDetalle",JSON.stringify(data));
                                    }                                     
                                  },
                                  function(tx,e){
                                     alert("Error" + e.message); 
                                      return false; 
                                  });
                              },
                              function(tx,e){
                                  alert("Error al procesar SQL: " + e.message);
                                  return false;
                              }
                            )
                    }


            });

        </script>
        <style type="text/css">
        .ui-loading .ui-loader { display: block; }
        .ui-loader { display: none; position: absolute; opacity: .85; z-index: 100; left: 50%; width: 200px; margin-left: -130px; margin-top: -35px; padding: 10px 30px; }
        </style>
    </body>
</html>
